<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_mrp_production_form_inherit_phd_tracking" model="ir.ui.view">
        <field name="name">mrp.production.form.view.inherit.phd.tracking</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_planned_start']" position="attributes">
                <attribute name="widget">date</attribute>
            </xpath>

            <xpath expr="//field[@name='date_planned_finished']" position="attributes">
                <attribute name="readonly">1</attribute>
                <attribute name="required">0</attribute>
                <attribute name="widget">date</attribute>
            </xpath>

            <xpath expr="//field[@name='date_planned_finished']" position="after">
                <button name="action_update_promised_finished_date" string="Update"
                        type="object" class="btn btn-link"/>
            </xpath>

            <xpath expr="//page[2]" position="after">
                <page string="Progress Tracking" name="progress_tracking">
                    <field name="delay_tracker_ids">
                        <tree editable="0" create="0" delete="0">
                            <field name="status_date" string="Status Date"/>
                            <field name="promised_date" string="Promised Date" required="1"/>
                            <field name="number_of_day_delayed" string="Number Of Days Delayed"/>
                            <field name="status" string="Status"/>
                            <field name="reason" string="Status Reason"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_mrp_production_kanban_inherit_phd_tracking" model="ir.ui.view">
        <field name="name">mrp.production.kanban.view.inherit.phd.tracking</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="phd_mrp.phd_mrp_production_view_kanban"/>
        <field name="arch" type="xml">
            <xpath expr='//div[hasclass("oe_kanban_bottom_left")]
            /span/t[@t-esc="record.date_deadline.value and record.date_deadline.value.split(&apos; &apos;)[0] or False"]'
                   position="after">
                <t t-if="record.date_planned_finished.value">
                    <br></br>
                    Promised Finished Date:
                    <field name="date_planned_finished" widget="date"/>
                </t>
                <t t-if="record.number_of_day_delayed.value > 0">
                    <br></br>
                    Delayed
                    <field name="number_of_day_delayed"/>
                    <t t-if="record.number_of_day_delayed.value > 1">days</t>
                    <t t-else="">day</t>
                </t>

            </xpath>
            <xpath expr="//div[hasclass('oe_kanban_bottom_right')]/div/span" position="after">
                <t t-if="record.status.value">
                    <t t-set="status_color" t-value="'ontrack'"/>
                    <t t-if="record.status.value == 'Delayed'">
                        <t t-set="status_color" t-value="'delayed'"/>
                    </t>
                    <t t-elif="record.status.value == 'On Hold'">
                        <t t-set="status_color" t-value="'onhold'"/>
                    </t>
                    <br></br>
                    <div t-attf-class="status_#{status_color}">
                        <field name="status"/>
                    </div>
                </t>
            </xpath>
        </field>
    </record>


    <record id="phd_tracking_mrp_production_tree_view_inherit" model="ir.ui.view">
        <field name="name">phd.mrp.production.tree.view</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state']" position="after">
                <field name="last_delay_tracker_status" optional="show"/>
                <field name="last_delay_tracker_reason" optional="show"/>
            </xpath>
        </field>
    </record>
</odoo>
