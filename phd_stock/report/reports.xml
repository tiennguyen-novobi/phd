<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.ui.view" id="phd_view_stock_quant_tree_editable">
        <field name="name">stock.quant.tree.editable.inherit</field>
        <field name="model">stock.quant</field>
        <field name="inherit_id" ref="stock.view_stock_quant_tree_editable"></field>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="attributes">
                <attribute name="default_order">product_id</attribute>
            </xpath>
        </field>
    </record>

    <record id="phd_warehouse_report_search" model="ir.ui.view">
        <field name="name">stock.move.search</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <search string="Stock Moves">
                    <field name="partner_id_warehouse" operator="child_of"/>
                    <field name="transaction_type" string="Transaction Type"/>
                    <field name="customer_po"/>
                    <field name="internal_po"/>
                    <field name="product_sku"/>
                    <field name="lot_id"/>
                    <group expand="0" string="Group By">
                        <filter name="customer_po" string="Customer PO" domain="[]" context="{'group_by': 'customer_po'}"/>
                        <filter name="internal_po" string="Internal PO" domain="[]" context="{'group_by': 'internal_po'}"/>
                        <filter name="product_sku" string="SKU" domain="[]" context="{'group_by': 'product_sku'}"/>
                        <filter name="lot_id" string="Lot" domain="[]" context="{'group_by': 'lot_id'}"/>
                    </group>
            </search>
        </field>
    </record>

<!--    <act_window id="filter_location_warehouse_report" name="Locations"-->
<!--                res_model="filter.location"-->
<!--                view_mode="form" target="new" context="{'is_warehouse_report': True}"/>-->

    <record id="warehouse_report_filter_location" model="ir.actions.server">
            <field name="name">Filter Location</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_filter_location"/>
            <field name="state">code</field>
            <field name="code">
                action = {
                    'type': 'ir.actions.act_window',
                    'res_model': 'filter.location',
                    'target': 'new',
                    'views': [(env.ref('phd_stock.filter_location_view_form').id, 'form')],
                    'context': {'is_warehouse_report': True},
                }
            </field>
        </record>

    <record id="phd_warehouse_report_tree" model="ir.ui.view">
        <field name="name">warehouse.stock.move.tree</field>
        <field name="model">stock.move</field>
        <field name="arch" type="xml">
            <tree create="0" edit="0" js_class="phd_date_range_export_report_list_view" default_order="product_sku">
                <field name="transaction_type"/>
                <field name="date" string="Transaction Date" widget='date'/>
                <field name="reference" string="Transaction ID"/>
                <field name="warehouse"/>
                <field name="product_sku"/>
                <field name="product_uom_qty" string="Quantity"/>
                <field name="lot_id"/>
                <field name="partner_id_warehouse" class="text-left"/>
                <field name="ship_to"/>
                <field name="internal_po"/>
                <field name="customer_po"/>
                <field name="is_warehouse_report" invisible="1"/>
<!--                <field name="trigger_field_warehouse" invisible="1"/>-->
                <field name="state" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="action_get_warehouse_report" model="ir.actions.server">
        <field name="name">Warehouse Report</field>
        <field name="model_id" ref="phd_stock.model_stock_move"/>
        <field name="state">code</field>
        <field name="code">action = model.action_get_warehouse_report()</field>
    </record>

    <record id="phd_warehouse_report_action" model="ir.actions.act_window">
        <field name="name">Warehouse Report</field>
        <field name="res_model">stock.move</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">tree</field>
        <field name="context" eval="{'list_view_report_id': ref('phd_stock.phd_warehoure_report'), 'date_range':'date'}" />
        <field name="domain" eval="[('is_warehouse_report', '=', True)]"/>
        <field name="search_view_id" ref="phd_warehouse_report_search"/>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('phd_warehouse_report_tree')})]"/>
    </record>

    <menuitem id="phd_warehouse_report_menu"
              name="Warehouse Report"
              action="warehouse_report_filter_location"
              parent="stock.menu_warehouse_report"
              sequence="1000"/>

<!--    <act_window id="filter_location_negative_report" name="Locations"-->
<!--                res_model="filter.location"-->
<!--                view_mode="form" target="new" context="{'is_negative_report': True}"/>-->


    <record id="action_negative_inventory_report" model="ir.actions.client">
            <field name="name">Negative Inventory Report</field>
            <field name="tag">forecasted_quantity_report</field>
            <field name="context" eval="{'model': 'phd.negative.report','is_negative_report': True}"/>
    </record>

    <record id="negative_report_filter_location" model="ir.actions.server">
            <field name="name">Filter Location</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_filter_location"/>
            <field name="state">code</field>
            <field name="code">
                action = {
                    'type': 'ir.actions.act_window',
                    'res_model': 'filter.location',
                    'target': 'new',
                    'views': [(env.ref('phd_stock.filter_location_view_form').id, 'form')],
                    'context': {'is_negative_report': True},
                }
            </field>
        </record>

    <menuitem id="phd_negative_report_menu"
              name="Negative Inventory Report"
              action="negative_report_filter_location"
              parent="stock.menu_warehouse_report"
              sequence="1001"/>

    <record model="ir.ui.view" id="phd_view_stock_quant_tree">
        <field name="name">stock.quant.tree</field>
        <field name="model">stock.quant</field>
        <field name="inherit_id" ref="stock_account.view_stock_quant_tree_inherit"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="attributes">
                <attribute name="default_order">product_id</attribute>
            </xpath>
            <xpath expr="//tree" position="attributes">
                <attribute name="js_class">phd_date_range_export_report_list_view</attribute>
            </xpath>
            <xpath expr="//field[@name='quantity']" position="attributes">
                <attribute name="widget">float</attribute>
            </xpath>
            <xpath expr="//field[@name='lot_id']" position="after">
                <field name="expiration_date" widget="date"/>
            </xpath>
            <xpath expr="//field[@name='product_id']" position="attributes">
                <attribute name="class">text-left</attribute>
            </xpath>
            <xpath expr="//field[@name='value']" position="attributes">
                <attribute name="widget">monetary</attribute>
                <attribute name="class">text-right</attribute>
            </xpath>
        </field>
    </record>

<!--    <act_window id="filter_product_lot_report" name="Locations"-->
<!--                res_model="filter.location"-->
<!--                view_mode="form" target="new" context="{'is_current_stock': True}"/>-->

    <record id="filter_product_lot_report" model="ir.actions.server">
        <field name="name">Filter Location</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_filter_location"/>
        <field name="state">code</field>
        <field name="code">
            action = {
                'type': 'ir.actions.act_window',
                'res_model': 'filter.location',
                'target': 'new',
                'views': [(env.ref('phd_stock.filter_location_view_form').id, 'form')],
                'context': {'is_current_stock': True},
            }
        </field>
    </record>

    <record model="ir.actions.act_window" id="phd_location_open_quants">
        <field name="domain">[('location_id', 'child_of', [default_location_id])]</field>
        <field name="name">Current Stock</field>
        <field name="context"
               eval="{'list_view_report_id': ref('phd_stock.phd_product_lot_report'), 'date_range':'expiration_date'}"/>
        <field name="res_model">stock.quant</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('phd_view_stock_quant_tree')})]"/>
    </record>

    <menuitem id="phd_current_stock_menu"
              name="Product Lot Report"
              action="filter_product_lot_report"
              parent="stock.menu_warehouse_report"
              sequence="1002"/>
</odoo>
