<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="phd_mrp_production_view_kanban" model="ir.ui.view">
        <field name="name">phd.mrp.production.view.kanban</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_kanban_view"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="replace">
                <kanban default_group_by="stage_id" quick_create="false" class="o_kanban_small_column o_kanban_mobile"
                        js_class="phd_mrp_order_kanban">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom_id" options="{'no_open':True,'no_create':True}"/>
                    <field name="date_deadline"/>
                    <field name="state"/>
                    <field name="is_locked"/>
                    <field name="routing_id"/>
                    <field name="date_planned_start"/>
                    <field name="confirm_cancel"/>
                    <field name="reservation_state"/>
                    <field name="date_planned_finished"/>
                    <field name="activity_state"/>
                    <progressbar field="activity_state"
                                 colors="{&quot;planned&quot;: &quot;success&quot;, &quot;today&quot;: &quot;warning&quot;, &quot;overdue&quot;: &quot;danger&quot;}"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings mt4">
                                        <strong class="o_kanban_record_title">
                                            <span>
                                                <t t-esc="record.product_id.value"/>
                                            </span>
                                        </strong>
                                    </div>
                                    <span class="float-right text-right">
                                        <t t-esc="record.product_qty.value"/>
                                        <small>
                                            <t t-esc="record.product_uom_id.value"/>
                                        </small>
                                    </span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <span>
                                        <strong>Planned Date:</strong>
                                        <t t-esc="record.date_planned_start.value.split(' ')[0]"/>
                                    </span>
                                    <span>
                                        <strong>to</strong>
                                        <t t-esc="record.date_planned_finished.value.split(' ')[0]"/>
                                    </span>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left text-muted">
                                        <span>
                                            <t t-esc="record.name.value"/>
                                            <t t-esc="record.date_deadline.value and record.date_deadline.value.split(' ')[0] or False"/>
                                        </span>
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <div>
                                            <span t-attf-class="badge #{['draft', 'cancel'].indexOf(record.state.raw_value) &gt; -1 ? 'badge-secondary' : ['none'].indexOf(record.state.raw_value) &gt; -1 ? 'badge-danger' : ['confirmed'].indexOf(record.state.raw_value) &gt; -1 ? 'badge-warning' : ['done'].indexOf(record.state.raw_value) &gt; -1 ? 'badge-success' : 'badge-primary'}">
                                                <t t-esc="record.state.value"/>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </xpath>
        </field>
    </record>

    <record id="phd_mrp_production_tree_view_inherit" model="ir.ui.view">
        <field name="name">phd.mrp.production.tree.view</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_planned_start']" position="attributes">
                <attribute name="widget">date</attribute>
            </xpath>
            <xpath expr="//tree" position="attributes">
                <attribute name="js_class">phd_tools_export_excel</attribute>
            </xpath>
        </field>
    </record>

    <record id="mrp.mrp_production_action" model="ir.actions.act_window">
        <field name="context">
            {
                'is_reformat_on_export_excel':
                {
                    'delete_field': ('activity_exception_decoration'),
                }
            }
        </field>
    </record>

    <record id="phd_mrp_production_form_view" model="ir.ui.view">
        <field name="name">phd.mrp.production.view.form</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='origin']" position="after">
                <field name="cert_analysis_number"/>
            </xpath>
<!--            <xpath expr="//button[@name='post_inventory']" position="attributes">-->
<!--                <attribute name="attrs">{'invisible': ['|', ('post_visible', '=', False), ('state', '!=', 'progress')]}</attribute>-->
<!--                <attribute name="groups"></attribute>-->
<!--            </xpath>-->
            <xpath expr="//button[@name='%(mrp.action_change_production_qty)d']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='button_mark_done']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('state', '!=', 'to_close'), ('purchase_id', '!=',
                    False)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='button_mark_done']" position="after">
<!--                <button name="add_consume" string="Add Materials" type="object" class="oe_highlight"/>-->
<!--                        attrs="{'invisible': ['|', ('state', '!=', 'progress'), ('reservation_state', '!=', False)]}"/>-->
                <button name="open_add_qty_to_produce" string="Add qty to consume" type="object" class="oe_highlight"
                attrs="{'invisible': ['|', ('purchase_id', '=', False), ('state', 'not in', ('progress', 'confirmed'))]}"/>
            </xpath>
            <xpath expr="//field[@name='date_planned_start']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[@for='date_planned_finished']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[@for='date_planned_start']" position="attributes">
                <attribute name="string">Planned End Date</attribute>
            </xpath>
        </field>
    </record>

    <record id="phd_view_production_calendar" model="ir.ui.view">
        <field name="name">mrp.production.calendar</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.view_production_calendar"/>
        <field eval="2" name="priority"/>
        <field name="arch" type="xml">
            <!--                <calendar date_start="date_planned_start" date_stop="date_planned_finished"-->
            <!--                          string="Manufacturing Orders" color="routing_id" event_limit="5">-->
            <!--                    <field name="routing_id"/>-->
            <!--                    <field name="user_id" avatar_field="image_128"/>-->
            <!--                    <field name="product_id"/>-->
            <!--                    <field name="product_qty"/>-->
            <!--                </calendar>-->

            <xpath expr="//calendar" position="attributes">
                <attribute name="js_class">phd_mrp_order_calendar</attribute>
                <attribute name="color">stage_id</attribute>
                <attribute name="mode">month</attribute>
                <attribute name="date_stop">date_planned_finished</attribute>
                <attribute name="date_start">date_planned_finished</attribute>
                <attribute name="event_limit">999</attribute>
            </xpath>
            <xpath expr="//field[@name='product_qty']" position="before">
                <field name="qty_produced"/>
            </xpath>
            <xpath expr="//field[@name='routing_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <record id="mrp.mrp_production_action" model="ir.actions.act_window">
        <field name="view_id" ref="phd_mrp_production_view_kanban"/>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph</field>
    </record>
</odoo>